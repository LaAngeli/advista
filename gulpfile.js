let gulp=require("gulp"),uglify=require("gulp-uglify"),cleanCSS=require("gulp-clean-css"),browserSync=require("browser-sync").create(),htmlMinifierTerser=require("html-minifier-terser"),imagemin=require("gulp-imagemin"),webp=require("gulp-webp"),through2=require("through2"),sizeOf=require("image-size"),fs=require("fs");function optimizeImages(){return gulp.src("images/**/*").pipe(imagemin([imagemin.mozjpeg({quality:75,progressive:!0}),imagemin.optipng({optimizationLevel:5}),imagemin.svgo({plugins:[{removeViewBox:!0},{cleanupIDs:!1}]})])).pipe(gulp.dest("dist/images"))}function convertToWebP(){return gulp.src("images/**/*.{jpg,png}").pipe(webp({quality:75,method:6})).pipe(gulp.dest("dist/images"))}function createResponsiveImages(){return gulp.src("images/**/*.{jpg,png}").pipe(through2.obj(function(s,e,i){sizeOf(s.path);let t=s.stem,r="dist/images/"+s.relative.replace(s.basename,"");[{width:320,suffix:"-320px"},{width:640,suffix:"-640px"},{width:1024,suffix:"-1024px"}].forEach(e=>{e=""+t+e.suffix+s.extname,e=r+e;fs.copyFileSync(s.path,e)}),fs.copyFileSync(s.path,r+s.basename),i(null,s)})).pipe(gulp.dest("dist/images"))}function replaceInFiles(r,n){gulp.src("dist/**/*.html").pipe(through2.obj(function(e,s,i){var t;e.isBuffer()&&(t=e.contents.toString().replace(r,n),e.contents=Buffer.from(t)),i(null,e)})).pipe(gulp.dest("dist")),gulp.src("dist/**/*.css").pipe(through2.obj(function(e,s,i){var t;e.isBuffer()&&(t=e.contents.toString().replace(r,n),e.contents=Buffer.from(t)),i(null,e)})).pipe(gulp.dest("dist"))}async function minifyHtml(){return gulp.src("*.html").pipe(through2.obj(async function(e,s,i){if(e.isBuffer())try{var t=await htmlMinifierTerser.minify(e.contents.toString(),{collapseWhitespace:!0,removeComments:!0,minifyCSS:!0,minifyJS:!0,ignoreCustomFragments:[/<script type="application\/ld\+json">[\s\S]*?<\/script>/]});e.contents=Buffer.from(t)}catch(e){return void i(e)}i(null,e)})).pipe(gulp.dest("dist/"))}function styles(){return gulp.src("*.css").pipe(cleanCSS()).pipe(gulp.dest("dist/"))}function scripts(){return gulp.src("*.js").pipe(uglify()).pipe(gulp.dest("dist/"))}function fonts(){return gulp.src("fonts/**/*").pipe(gulp.dest("dist/fonts"))}function watch(){browserSync.init({server:{baseDir:"./dist"}}),gulp.watch("*.js",scripts).on("change",browserSync.reload),gulp.watch("*.css",styles).on("change",browserSync.reload),gulp.watch("*.html",gulp.series(minifyHtml)).on("change",browserSync.reload),gulp.watch("images/**/*",gulp.series(optimizeImages,convertToWebP,createResponsiveImages)).on("change",browserSync.reload),gulp.watch("fonts/**/*",fonts).on("change",browserSync.reload)}let build=gulp.series(scripts,styles,fonts,gulp.parallel(optimizeImages,convertToWebP,createResponsiveImages),minifyHtml),serve=gulp.series(build,watch);exports.styles=styles,exports.minifyHtml=minifyHtml,exports.scripts=scripts,exports.optimizeImages=optimizeImages,exports.convertToWebP=convertToWebP,exports.createResponsiveImages=createResponsiveImages,exports.fonts=fonts,exports.watch=watch,exports.build=build,exports.serve=serve,exports.replaceInFiles=replaceInFiles;